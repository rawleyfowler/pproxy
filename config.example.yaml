# /etc/webproxy/config.yml

proxy:
  listen: 0.0.0.0:443
  tls:
    mode: auto               # auto | manual | off
    email: admin@mywebsite.com
    cache_dir: /etc/webproxy/certs

domains:
  - name: www.mywebsite.com
    type: public
    strategy: round_robin     # round_robin | least_conn | ip_hash
    health_check:
      path: /healthz
      interval: 10s
      timeout: 2s
      retries: 3
    upstreams:
      - address: 10.0.0.12:8080
        weight: 1
      - address: 10.0.0.13:8080
        weight: 1
    failover: # If none of the upstreams are reachable, use the failover.
      - address: 10.0.0.14:8080
        weight: 1
    timeouts:
      connect: 3s
      read: 10s
    rate_limit:
      requests_per_minute: 1200
    routes:
      - path: /static/
        cache: true
        cache_ttl: 300
      - path: /api/
        strip_prefix: /api
        proxy_to: upstreams
    logging:
      access_log: /var/log/webproxy/access.log
      error_log: /var/log/webproxy/error.log

  - name: api.mywebsite.com
    type: internal
    strategy: least_conn
    upstreams:
      - address: 10.0.1.20:5000
      - address: 10.0.1.21:5000
    tls:
      mode: off
